{% extends "base.html" %}

{% block title %}Trainer Dashboard - {{ site_name }}{% endblock %}

{% block content %}
<section class="py-5" style="margin-top: 100px;">
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show"
            role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Pending Approval Banner -->
        {% if current_user.is_pending_approval %}
        <div class="alert alert-warning border-warning shadow-sm mb-4" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-clock fa-2x me-3 text-warning"></i>
                <div>
                    <h5 class="mb-1"><i class="fas fa-hourglass-half"></i> Account Pending Approval</h5>
                    <p class="mb-0">Your trainer account is currently under review. An admin will approve your account
                        shortly. Some features may be limited until approval.</p>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row mb-4">
            <div class="col-md-8">
                <h1><i class="fas fa-chalkboard-teacher text-success"></i> Trainer Dashboard</h1>
                <p class="text-muted">
                    Welcome back, <strong>{{ current_user.name }}</strong>!
                    <span class="badge bg-success">Trainer</span>
                    {% if current_user.is_approved %}
                    <span class="badge bg-primary"><i class="fas fa-check"></i> Approved</span>
                    {% else %}
                    <span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> Pending</span>
                    {% endif %}
                </p>
            </div>
            <div class="col-md-4 text-end">
                <a href="{{ url_for('courses') }}" class="btn btn-outline-primary">
                    <i class="fas fa-book"></i> All Courses
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Trainer Profile Card -->
        <div class="card shadow mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-id-card"></i> Trainer Profile</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-user"></i> Name:</strong> {{ current_user.name }}</p>
                        <p><strong><i class="fas fa-envelope"></i> Email:</strong> {{ current_user.email }}</p>
                        <p><strong><i class="fas fa-phone"></i> Phone:</strong> {{ current_user.phone or 'Not provided'
                            }}</p>
                        <p><strong><i class="fas fa-calendar"></i> Member Since:</strong> {{
                            current_user.created_at.strftime('%d %B %Y') }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-graduation-cap"></i> Education:</strong> {{ current_user.education
                            or 'Not specified' }}</p>
                        <p><strong><i class="fas fa-briefcase"></i> Experience:</strong> {{ current_user.experience or 0
                            }} years</p>
                        <p><strong><i class="fas fa-tools"></i> Expertise:</strong> {{ current_user.expertise or 'Not
                            specified' }}</p>
                    </div>
                </div>
                {% if current_user.bio %}
                <hr>
                <p><strong><i class="fas fa-info-circle"></i> About:</strong></p>
                <p class="text-muted">{{ current_user.bio }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Stats -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stat-card success">
                    <div>
                        <div class="stat-card-label">Assigned Courses</div>
                        <div class="stat-card-value">{{ assigned_courses|length if assigned_courses else 0 }}</div>
                    </div>
                    <div class="stat-card-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card primary">
                    <div>
                        <div class="stat-card-label">Total Students</div>
                        <div class="stat-card-value">{{ total_students if total_students else 0 }}</div>
                    </div>
                    <div class="stat-card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card warning">
                    <div>
                        <div class="stat-card-label">Pending Reviews</div>
                        <div class="stat-card-value">{{ pending_reviews if pending_reviews else 0 }}</div>
                    </div>
                    <div class="stat-card-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card {{ 'info' if current_user.is_approved else 'secondary' }}">
                    <div>
                        <div class="stat-card-label">Status</div>
                        <div class="stat-card-value" style="font-size: 1rem;">{{ 'Active' if current_user.is_approved
                            else 'Pending' }}</div>
                    </div>
                    <div class="stat-card-icon">
                        <i class="fas fa-{{ 'check-circle' if current_user.is_approved else 'clock' }}"></i>
                    </div>
                </div>
            </div>
        </div>

        {% if current_user.is_approved %}
        <!-- Course Management -->
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-book"></i> My Courses</h5>
            </div>
            <div class="card-body">
                {% if assigned_courses and assigned_courses|length > 0 %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Level</th>
                                <th>Duration</th>
                                <th>Enrolled Students</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for course in assigned_courses %}
                            <tr>
                                <td><strong>{{ course.name }}</strong></td>
                                <td><span class="badge bg-info">{{ course.level }}</span></td>
                                <td>{{ course.duration }}</td>
                                <td>{{ course.enrollments|length }}</td>
                                <td>
                                    <a href="{{ url_for('course_detail', id=course.id) }}"
                                        class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle"></i> No courses assigned yet. Contact admin to get courses assigned.
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card shadow mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-primary">
                            <div class="card-body text-center">
                                <i class="fas fa-user-graduate fa-3x text-primary mb-3"></i>
                                <h5>View Students</h5>
                                <p class="text-muted small">See all enrolled students in your courses</p>
                                <button class="btn btn-outline-primary btn-sm" disabled>
                                    <i class="fas fa-arrow-right"></i> Coming Soon
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <div class="card-body text-center">
                                <i class="fas fa-tasks fa-3x text-success mb-3"></i>
                                <h5>Create Assignment</h5>
                                <p class="text-muted small">Create assignments for your students</p>
                                <button class="btn btn-outline-success btn-sm" disabled>
                                    <i class="fas fa-arrow-right"></i> Coming Soon
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-warning">
                            <div class="card-body text-center">
                                <i class="fas fa-calendar-alt fa-3x text-warning mb-3"></i>
                                <h5>Schedule Session</h5>
                                <p class="text-muted small">Schedule live sessions with students</p>
                                <button class="btn btn-outline-warning btn-sm" disabled>
                                    <i class="fas fa-arrow-right"></i> Coming Soon
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}